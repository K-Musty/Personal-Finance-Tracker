{% extends "base.html" %}

{% block content %}
<script>
     try {
        window.chartData = JSON.parse('{{ chart_data_json|tojson|safe }}');
        console.log("Chart data loaded:", window.chartData);
    } catch (e) {
        console.error("Error parsing chart data:", e);
        window.chartData = { labels: ['Error'], data: [1] };
    }
</script>
<div class="dashboard">
    <h1>Dashboard</h1>
    <p>Welcome back, {{ current_user.name }}! Here's your financial overview.</p>

    <div class="stats">
        <div>
            <h3>Current Balance</h3>
            <p>${{ "%.2f"|format(current_balance) }}</p>
        </div>
        <div>
            <h3>Recent Income</h3>
            <p>${{ "%.2f"|format(recent_income) }}</p>
        </div>
        <div>
            <h3>Recent Expenses</h3>
            <p>${{ "%.2f"|format(recent_expenses) }}</p>
        </div>
    </div>

    <div>
    <label for="monthSelector">Select Month:</label>
    <select id="monthSelector" name="monthSelector">
        <option value="">All Time</option>
    </select>
    </div>

    <div class="chart-container" style="width: 80%; max-width: 500px; margin: 20px auto;">
    <canvas id="spendingChart"></canvas>
    </div>


    <div class="transaction-form">
        <h3>Add Transaction</h3>
        <form id="add-transaction-form" method="POST">
            {{ form.hidden_tag() }}
            <div>
                {{ form.amount.label }} {{ form.amount() }}
            </div>
            <div>
                {{ form.category.label }} {{ form.category() }}
            </div>
            <div>
                {{ form.description.label }} {{ form.description() }}
            </div>
            {{ form.submit() }}
        </form>
    </div>

    <div class="recent-transactions">
        <h3>Recent Transactions</h3>
        <ul>
            {% for t in recent_transactions %}
            <li>
                {{ t.category|title }}: ${{ "%.2f"|format(t.amount) }} - {{ t.description }}
            </li>
            {% endfor %}
        </ul>
    </div>
</div>
{% endblock %}

{% block scripts %}

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script type="text/javascript" src="{{ url_for('static', filename='js/dashboard.js') }}"></script>

{% endblock %}